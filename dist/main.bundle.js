"use strict";

var Data = {
  "about_me": "\n      <img style=\"float:left;padding: 0px 15px 15px 0px;\" src=\"images/eu.jpg\" widht=\"104\" height=\"105\" />\n      <p>Hi, I'm a professional software developer, interested in a wide range of topics: web development, e-commerce, graphics programming, automated testing, blockchain.... You can browse through my previous works in the other column.  \n      </p>\n\t<p>This webpage is itself a game. You can control the main character that appears in the middle of the screen using the cursor keys and it should avoid colliding with the big enemy balls. Most of the text is rendered using Javascript. \n      <p>\n      Some time ago I started to contribute and/or helped to initialize a few Open Source projects. Please don't hesitate on contact me in order to collaborate or ask any question about them. \n      </p>\n        <p>You can find me on <a href=\"http://twitter.com/galchwyn\">Twitter</a>,\n          <a href=\"http://facebook.com/manel.villar\">Facebook</a>,\n          <a href=\"http://http://es.linkedin.com/in/manelvillar\" >LinkedIn</a>,\n          <a href=\"http://github.com/manelvf\">Github</a>,\n\t      <a href=\"https://www.slideshare.net/manelvillar/\">Slideshare</a>\n          or simply by <a href=\"mailto:eu@manel.pro\" >email</a>.\n\t",

  "links": "\n\t<p>You might be interested in checking my technical blog: <a href=\"/blog\">The Fallen Apples</a>. I write sometimes in <a href=\"https://medium.com/@fallenapples\">Medium</a> too.\n\t</p>\n      <p>These are my <a href=\"http://js1k.com\">JS1K</a> and JS demo entries:</p>\n      <ul class=\"square\">\n        <li><a href=\"http://js1k.com/2010-first/demos/38\">Pulse</a>. A light \"pulsar\" made for the first compo (2010)</li>\n        <li><a href=\"http://js1k.com/2012-love/demo/1025\">Hidden Love</a>. Entry for 2012 compo, themed \"Love\"</li>\n        <li><a href=\"https://www.manel.pro/drones\">Battle of the Drones</a>. Entry for <a href=\"http://ludumdare.com\">Ludum Dare 25</a></li>\n      </ul>\n\n        <ul class=\"square\">\n          <li><a href=\"http://https://vimeo.com/album/93295\" >Ilion Tools</a>: Some videos made from the tools developed on Ilion Animation Studios [ExtJS] (2007-2009).</li>\n        </ul>\n\n\t"
};
"use strict";

// return -1 or 1
function getRandomSign() {
  var v = Math.round(Math.random());
  if (v == 0) return -1;else return 1;
}

function getRandomWithLimit(min, max) {
  var v = void 0;

  do {
    // search for a nice value. If not found, try again
    v = Math.round(Math.random() * (max - min)) + min;
  } while (v > max * App.borderLimit && v < max - max * App.borderLimit);

  return v;
}

function zeropad(v, n) {
  var z = n - String(v).length;
  var s = "";
  for (var c = 0; c < z; c++) {
    s += "0";
  }
  return s + v;
}

function Ball(ctx) {
  this.ctx = ctx;
}

Ball.prototype.init = function (radius) {
  this.dx = getRandomSign();
  this.dy = getRandomSign();
  this.x = getRandomWithLimit(0, App.availW);
  this.y = getRandomWithLimit(0, App.availH);
  this.radius = radius || App.ball_radius || 50;
};

Ball.prototype.draw = function () {
  var ctx = App.ctx;
  ctx.fillStyle = "rgba(100, 255, 205, 0.5)";
  ctx.strokeStyle = "rgba(50, 200, 100, 0.8)";
  ctx.beginPath();
  ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, true);
  ctx.fill();
  ctx.stroke();
};

Ball.prototype.move = function () {
  this.x += this.dx;
  this.y += this.dy;

  if (this.x + this.radius > App.availW) this.dx = -1;else if (this.x - this.radius < 0) this.dx = 1;

  if (this.y + this.radius > App.availH) this.dy = -1;else if (this.y - this.radius < 0) this.dy = 1;
};

var App = {
  balls: [],
  ball_radius: 35,
  n_of_balls: 7,
  keypressed: [],
  keyListeners: [], // functions to listen for keys pressed
  availW: 0,
  availH: 0,
  PERIOD: 1000 / 30, // millisenconds
  borderLimit: 0.25 // for new balls
};

function Hero() {}

Hero.prototype.init = function () {
  this.points = 0;
  this.x = App.availW / 2;
  this.y = App.availH / 2;
  this.radius = 40;
  if (this.keyEvent) delete App.keyListeners[this.keyEvent - 1];
  this.keyEvent = App.keyListeners.push(this.checkMovement());
};

Hero.prototype.draw = function () {
  var ctx = App.ctx;
  ctx.fillStyle = "rgba(255, 100, 100, 0.5)";
  ctx.fillRect(this.x - 20, this.y - 20, 40, 40);
  ctx.strokeStyle = "rgba(155, 50, 50, 0.8)";
  ctx.strokeRect(this.x - 20, this.y - 20, 40, 40);

  ctx.fillStyle = "rgba(255, 255, 100, 0.5)";
  ctx.beginPath();
  ctx.arc(this.x, this.y, 12, 0, Math.PI, false); // Mouth (clockwise)
  ctx.moveTo(this.x - 10, this.y - 10);
  ctx.arc(this.x - 10, this.y - 10, 5, 0, Math.PI * 2, true); // Left eye
  ctx.moveTo(this.x + 10, this.y - 10);
  ctx.arc(this.x + 10, this.y - 10, 5, 0, Math.PI * 2, true); // Right eye
  ctx.stroke();
};

Hero.prototype.checkMovement = function () {
  var that = this;

  return function () {

    if (App.keypressed[37]) {
      that.x--;
      that.points++;
    }
    if (App.keypressed[39]) {
      that.x++;
      that.points++;
    }
    if (App.keypressed[38]) {
      that.y--;
      that.points++;
    }
    if (App.keypressed[40]) {
      that.y++;
      that.points++;
    }
  };
};

var hero = new Hero();

function doMovements() {
  for (var k = 0; k < App.keyListeners.length; k++) {
    if (typeof App.keyListeners[k] == "function") App.keyListeners[k]();
  }
}

function draw() {
  var ctx = App.ctx;
  var balls = App.balls;

  ctx.clearRect(0, 0, App.availW, App.availH); // clear canvas
  ctx.save();

  hero.draw();

  for (var k = 0; k < balls.length; k++) {
    var b = balls[k];
    b.move();
    b.draw();
  }

  ctx.fillStyle = "rgba(100, 100, 255, 0.8)";
  ctx.fillText(zeropad(hero.points, 8), App.availW * (2 / 3), 40);
  ctx.fillStyle = "rgba(100, 100, 255, 0.6)";
  ctx.fillText("Use the Arrow Keys to SURVIVE!", App.availW * (3 / 7), App.availH * (2 / 3));

  ctx.restore();

  window.requestAnimationFrame(draw);
}

function checkPositions(el1, el2) {
  var dx = el1.x - el2.x;
  var dy = el1.y - el2.y;

  var d = Math.sqrt(dx * dx + dy * dy);
  var r = el1.radius + el2.radius;

  if (r > d) return true;else return false;
}

function checkMovements() {
  var balls = App.balls;

  for (var k = 0; k < balls.length; k++) {
    if (checkPositions(hero, balls[k])) {
      hero.init();
    }
    if (checkPositions(balls[k], balls[(k + 1) % balls.length])) {
      balls[k].dx *= -1;
      balls[k].dy *= -1;
      balls[k].x += balls[k].dx * 3;
      balls[k].y += balls[k].dy * 3;
      var b = balls[(k + 1) % balls.length];
      b.dx *= -1;
      b.dy *= -1;
      b.x += b.dx * 2;
      b.y += b.dy * 2;
    }
  }
}

function init() {
  var winW = void 0,
      winH = void 0;

  if (document.body && document.body.offsetWidth) {
    winW = document.body.offsetWidth;
    winH = document.body.offsetHeight;
  }
  if (document.compatMode == 'CSS1Compat' && document.documentElement && document.documentElement.offsetWidth) {
    winW = document.documentElement.offsetWidth;
    winH = document.documentElement.offsetHeight;
  }
  if (window.innerWidth && window.innerHeight) {
    winW = window.innerWidth;
    winH = window.innerHeight;
  }

  var el = document.getElementById("screenFrame");
  el.style["background-color"] = "transparent";
  el.style["color"] = "red";
  el.style.left = "0px";
  el.style.top = "0px";
  el.style.width = winW + "px";
  el.style.height = winH + "px";
  el.style.display = "block";

  var frame = document.getElementById("frame");
  frame.width = winW;
  frame.height = winH;

  App.availW = winW;
  App.availH = winH;
  App.frame = frame;

  if (frame.getContext) {
    App.ctx = frame.getContext("2d");
    App.ctx.font = "20pt Arial";

    var i = 0;

    var _loop = function _loop() {
      var b = new Ball(App.ctx);
      b.init();

      var collisions = App.balls.filter(function (ball) {
        return checkPositions(b, ball);
      });
      if (collisions.length) {
        return "continue";
      }

      App.balls.push(b);
      i++;
    };

    while (i < App.n_of_balls) {
      var _ret = _loop();

      if (_ret === "continue") continue;
    }

    hero.init();

    window.onkeydown = function (e) {
      App.keypressed[e.which] = true;
    };
    window.onkeyup = function (e) {
      App.keypressed[e.which] = false;
    };

    App.frame.addEventListener("touchstart", handleTouchStart, false);
    App.frame.addEventListener("touchend", handleTouchEnd, false);

    window.requestAnimationFrame(draw);
    setInterval(checkMovements, 1000 / 30);
    setInterval(doMovements, 1000 / 30);
  }

  function handleTouchStart(evt) {
    evt.preventDefault();
    console.log("touchstart.");
    var touches = evt.changedTouches;

    for (var i = 0; i < touches.length; i++) {
      console.log("touchstart:" + i + "..." + touches[i]);
      console.log("touchstart:" + i + ".");
    }
  }

  function handleTouchEnd(evt) {
    evt.preventDefault();
    var touches = evt.changedTouches;

    for (var i = 0; i < touches.length; i++) {
      console.log(touches[i]);
    }
  }
}
"use strict";

// init 
ready(function () {
  expand_json();

  init();
});

function intitle(str) {
  return "<h3>" + (str.charAt(0).toUpperCase() + str.slice(1)).replace("_", " ") + "</h3>";
}

function expand_json() {
  for (var key in Data) {
    document.getElementById(key).innerHTML = intitle(key) + Data[key];
  }
}

function ready(fn) {
  if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
    fn();
  } else {
    document.addEventListener('DOMContentLoaded', fn);
  }
}

function toggleClass(el, className) {
  if (el.classList) {
    el.classList.toggle(className);
  } else {
    var classes = el.className.split(' ');
    var existingIndex = classes.indexOf(className);

    if (existingIndex >= 0) classes.splice(existingIndex, 1);else classes.push(className);

    el.className = classes.join(' ');
  }
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2pzL2RhdGEuanMiLCIuLi9qcy9nYW1lLmpzIiwiLi4vanMvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQUksT0FBTztBQUNWLHF3Q0FEVTs7QUFpQlY7QUFqQlUsQ0FBWDs7O0FDQ0E7QUFDQSxTQUFTLGFBQVQsR0FBeUI7QUFDdkIsTUFBSSxJQUFJLEtBQUssS0FBTCxDQUFXLEtBQUssTUFBTCxFQUFYLENBQVI7QUFDQSxNQUFJLEtBQUcsQ0FBUCxFQUNFLE9BQU8sQ0FBQyxDQUFSLENBREYsS0FHRSxPQUFPLENBQVA7QUFDSDs7QUFFRCxTQUFTLGtCQUFULENBQTRCLEdBQTVCLEVBQWdDLEdBQWhDLEVBQXFDO0FBQ25DLE1BQUksVUFBSjs7QUFFQSxLQUFHO0FBQ0Q7QUFDQSxRQUFJLEtBQUssS0FBTCxDQUFXLEtBQUssTUFBTCxNQUFpQixNQUFJLEdBQXJCLENBQVgsSUFBd0MsR0FBNUM7QUFDRCxHQUhELFFBR1UsSUFBSyxNQUFNLElBQUksV0FBaEIsSUFDTixJQUFLLE1BQU8sTUFBTSxJQUFJLFdBSnpCOztBQU9BLFNBQU8sQ0FBUDtBQUNEOztBQUVELFNBQVMsT0FBVCxDQUFpQixDQUFqQixFQUFtQixDQUFuQixFQUFzQjtBQUNwQixNQUFJLElBQUksSUFBSSxPQUFPLENBQVAsRUFBVSxNQUF0QjtBQUNBLE1BQUksSUFBSSxFQUFSO0FBQ0EsT0FBSyxJQUFJLElBQUksQ0FBYixFQUFnQixJQUFJLENBQXBCLEVBQXVCLEdBQXZCLEVBQTRCO0FBQzFCLFNBQUssR0FBTDtBQUNEO0FBQ0QsU0FBTyxJQUFFLENBQVQ7QUFDRDs7QUFJRCxTQUFTLElBQVQsQ0FBZSxHQUFmLEVBQW1CO0FBQ2pCLE9BQUssR0FBTCxHQUFXLEdBQVg7QUFDRDs7QUFFRCxLQUFLLFNBQUwsQ0FBZSxJQUFmLEdBQXNCLFVBQVMsTUFBVCxFQUFpQjtBQUNyQyxPQUFLLEVBQUwsR0FBVSxlQUFWO0FBQ0EsT0FBSyxFQUFMLEdBQVUsZUFBVjtB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LEVBQWYsRUFBbUI7QUFDakIsTUFBSSxTQUFTLFdBQVQsR0FBdUIsU0FBUyxVQUFULEtBQXdCLFVBQS9DLEdBQTRELFNBQVMsVUFBVCxLQUF3QixTQUF4RixFQUFrRztBQUNoRztBQUNELEdBRkQsTUFFTztBQUNMLGFBQVMsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQThDLEVBQTlDO0FBQ0Q7QUFDRjs7QUFHRCxTQUFTLFdBQVQsQ0FBcUIsRUFBckIsRUFBeUIsU0FBekIsRUFBb0M7QUFDaEMsTUFBSSxHQUFHLFNBQVAsRUFBa0I7QUFDaEIsT0FBRyxTQUFILENBQWEsTUFBYixDQUFvQixTQUFwQjtBQUNELEdBRkQsTUFFTztBQUNMLFFBQUksVUFBVSxHQUFHLFNBQUgsQ0FBYSxLQUFiLENBQW1CLEdBQW5CLENBQWQ7QUFDQSxRQUFJLGdCQUFnQixRQUFRLE9BQVIsQ0FBZ0IsU0FBaEIsQ0FBcEI7O0FBRUEsUUFBSSxpQkFBaUIsQ0FBckIsRUFDRSxRQUFRLE1BQVIsQ0FBZSxhQUFmLEVBQThCLENBQTlCLEVBREYsS0FHRSxRQUFRLElBQVIsQ0FBYSxTQUFiOztBQUVGLE9BQUcsU0FBSCxHQUFlLFFBQVEsSUFBUixDQUFhLEdBQWIsQ0FBZjtBQUNEO0FBQ0oiLCJmaWxlIjoibWFpbi5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgRGF0YSA9IHtcblx0XCJhYm91dF9tZVwiOiBgXG4gICAgICA8aW1nIHN0eWxlPVwiZmxvYXQ6bGVmdDtwYWRkaW5nOiAwcHggMTVweCAxNXB4IDBweDtcIiBzcmM9XCJpbWFnZXMvZXUuanBnXCIgd2lkaHQ9XCIxMDRcIiBoZWlnaHQ9XCIxMDVcIiAvPlxuICAgICAgPHA+SGksIEknbSBhIHByb2Zlc3Npb25hbCBzb2Z0d2FyZSBkZXZlbG9wZXIsIGludGVyZXN0ZWQgaW4gYSB3aWRlIHJhbmdlIG9mIHRvcGljczogd2ViIGRldmVsb3BtZW50LCBlLWNvbW1lcmNlLCBncmFwaGljcyBwcm9ncmFtbWluZywgYXV0b21hdGVkIHRlc3RpbmcsIGJsb2NrY2hhaW4uLi4uIFlvdSBjYW4gYnJvd3NlIHRocm91Z2ggbXkgcHJldmlvdXMgd29ya3MgaW4gdGhlIG90aGVyIGNvbHVtbi4gIFxuICAgICAgPC9wPlxuXHQ8cD5UaGlzIHdlYnBhZ2UgaXMgaXRzZWxmIGEgZ2FtZS4gWW91IGNhbiBjb250cm9sIHRoZSBtYWluIGNoYXJhY3RlciB0aGF0IGFwcGVhcnMgaW4gdGhlIG1pZGRsZSBvZiB0aGUgc2NyZWVuIHVzaW5nIHRoZSBjdXJzb3Iga2V5cyBhbmQgaXQgc2hvdWxkIGF2b2lkIGNvbGxpZGluZyB3aXRoIHRoZSBiaWcgZW5lbXkgYmFsbHMuIE1vc3Qgb2YgdGhlIHRleHQgaXMgcmVuZGVyZWQgdXNpbmcgSmF2YXNjcmlwdC4gXG4gICAgICA8cD5cbiAgICAgIFNvbWUgdGltZSBhZ28gSSBzdGFydGVkIHRvIGNvbnRyaWJ1dGUgYW5kL29yIGhlbHBlZCB0byBpbml0aWFsaXplIGEgZmV3IE9wZW4gU291cmNlIHByb2plY3RzLiBQbGVhc2UgZG9uJ3QgaGVzaXRhdGUgb24gY29udGFjdCBtZSBpbiBvcmRlciB0byBjb2xsYWJvcmF0ZSBvciBhc2sgYW55IHF1ZXN0aW9uIGFib3V0IHRoZW0uIFxuICAgICAgPC9wPlxuICAgICAgICA8cD5Zb3UgY2FuIGZpbmQgbWUgb24gPGEgaHJlZj1cImh0dHA6Ly90d2l0dGVyLmNvbS9nYWxjaHd5blwiPlR3aXR0ZXI8L2E+LFxuICAgICAgICAgIDxhIGhyZWY9XCJodHRwOi8vZmFjZWJvb2suY29tL21hbmVsLnZpbGxhclwiPkZhY2Vib29rPC9hPixcbiAgICAgICAgICA8YSBocmVmPVwiaHR0cDovL2h0dHA6Ly9lcy5saW5rZWRpbi5jb20vaW4vbWFuZWx2aWxsYXJcIiA+TGlua2VkSW48L2E+LFxuICAgICAgICAgIDxhIGhyZWY9XCJodHRwOi8vZ2l0aHViLmNvbS9tYW5lbHZmXCI+R2l0aHViPC9hPixcblx0ICAgICAgPGEgaHJlZj1cImh0dHBzOi8vd3d3LnNsaWRlc2hhcmUubmV0L21hbmVsdmlsbGFyL1wiPlNsaWRlc2hhcmU8L2E+XG4gICAgICAgICAgb3Igc2ltcGx5IGJ5IDxhIGhyZWY9XCJtYWlsdG86ZXVAbWFuZWwucHJvXCIgPmVtYWlsPC9hPi5cblx0YCxcblxuXHRcImxpbmtzXCI6IGBcblx0PHA+WW91IG1pZ2h0IGJlIGludGVyZXN0ZWQgaW4gY2hlY2tpbmcgbXkgdGVjaG5pY2FsIGJsb2c6IDxhIGhyZWY9XCIvYmxvZ1wiPlRoZSBGYWxsZW4gQXBwbGVzPC9hPi4gSSB3cml0ZSBzb21ldGltZXMgaW4gPGEgaHJlZj1cImh0dHBzOi8vbWVkaXVtLmNvbS9AZmFsbGVuYXBwbGVzXCI+TWVkaXVtPC9hPiB0b28uXG5cdDwvcD5cbiAgICAgIDxwPlRoZXNlIGFyZSBteSA8YSBocmVmPVwiaHR0cDovL2pzMWsuY29tXCI+SlMxSzwvYT4gYW5kIEpTIGRlbW8gZW50cmllczo8L3A+XG4gICAgICA8dWwgY2xhc3M9XCJzcXVhcmVcIj5cbiAgICAgICAgPGxpPjxhIGhyZWY9XCJodHRwOi8vanMxay5jb20vMjAxMC1maXJzdC9kZW1vcy8zOFwiPlB1bHNlPC9hPi4gQSBsaWdodCBcInB1bHNhclwiIG1hZGUgZm9yIHRoZSBmaXJzdCBjb21wbyAoMjAxMCk8L2xpPlxuICAgICAgICA8bGk+PGEgaHJlZj1cImh0dHA6Ly9qczFrLmNvbS8yMDEyLWxvdmUvZGVtby8xMDI1XCI+SGlkZGVuIExvdmU8L2E+LiBFbnRyeSBmb3IgMjAxMiBjb21wbywgdGhlbWVkIFwiTG92ZVwiPC9saT5cbiAgICAgICAgPGxpPjxhIGhyZWY9XCJodHRwczovL3d3dy5tYW5lbC5wcm8vZHJvbmVzXCI+QmF0dGxlIG9mIHRoZSBEcm9uZXM8L2E+LiBFbnRyeSBmb3IgPGEgaHJlZj1cImh0dHA6Ly9sdWR1bWRhcmUuY29tXCI+THVkdW0gRGFyZSAyNTwvYT48L2xpPlxuICAgICAgPC91bD5cblxuICAgICAgICA8dWwgY2xhc3M9XCJzcXVhcmVcIj5cbiAgICAgICAgICA8bGk+PGEgaHJlZj1cImh0dHA6Ly9odHRwczovL3ZpbWVvLmNvbS9hbGJ1bS85MzI5NVwiID5JbGlvbiBUb29sczwvYT46IFNvbWUgdmlkZW9zIG1hZGUgZnJvbSB0aGUgdG9vbHMgZGV2ZWxvcGVkIG9uIElsaW9uIEFuaW1hdGlvbiBTdHVkaW9zIFtFeHRKU10gKDIwMDctMjAwOSkuPC9saT5cbiAgICAgICAgPC91bD5cblxuXHRgXG59XG4iLCJcbi8vIHJldHVybiAtMSBvciAxXG5mdW5jdGlvbiBnZXRSYW5kb21TaWduKCkge1xuICBsZXQgdiA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSk7XG4gIGlmICh2PT0wKSBcbiAgICByZXR1cm4gLTE7XG4gIGVsc2UgXG4gICAgcmV0dXJuIDE7XG59XG5cbmZ1bmN0aW9uIGdldFJhbmRvbVdpdGhMaW1pdChtaW4sbWF4KSB7XG4gIGxldCB2O1xuXG4gIGRvIHtcbiAgICAvLyBzZWFyY2ggZm9yIGEgbmljZSB2YWx1ZS4gSWYgbm90IGZvdW5kLCB0cnkgYWdhaW5cbiAgICB2ID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogKG1heC1taW4pKSArIG1pbjtcbiAgfSB3aGlsZSggKHYgPiAobWF4ICogQXBwLmJvcmRlckxpbWl0KSkgJiZcbiAgICAodiA8IChtYXggLSAobWF4ICogQXBwLmJvcmRlckxpbWl0KSkpXG4gICk7XG5cbiAgcmV0dXJuIHY7XG59XG5cbmZ1bmN0aW9uIHplcm9wYWQodixuKSB7XG4gIGxldCB6ID0gbiAtIFN0cmluZyh2KS5sZW5ndGg7XG4gIGxldCBzID0gXCJcIjtcbiAgZm9yIChsZXQgYyA9IDA7IGMgPCB6OyBjKyspIHtcbiAgICBzICs9IFwiMFwiO1xuICB9XG4gIHJldHVybiBzK3Y7XG59XG5cblxuXG5mdW5jdGlvbiBCYWxsIChjdHgpe1xuICB0aGlzLmN0eCA9IGN0eDtcbn1cblxuQmFsbC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKHJhZGl1cykge1xuICB0aGlzLmR4ID0gZ2V0UmFuZG9tU2lnbigpO1xuICB0aGlzLmR5ID0gZ2V0UmFuZG9tU2lnbigpO1xuICB0aGlzLnggPSBnZXRSYW5kb21XaXRoTGltaXQoMCwgQXBwLmF2YWlsVyk7XG4gIHRoaXMueSA9IGdldFJhbmRvbVdpdGhMaW1pdCgwLCBBcHAuYXZhaWxIKTtcbiAgdGhpcy5yYWRpdXMgPSByYWRpdXMgfHwgQXBwLmJhbGxfcmFkaXVzIHx8IDUwO1xufVxuXG5CYWxsLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24oKSB7XG4gIGxldCBjdHggPSBBcHAuY3R4O1xuICBjdHguZmlsbFN0eWxlID0gXCJyZ2JhKDEwMCwgMjU1LCAyMDUsIDAuNSlcIjtcbiAgY3R4LnN0cm9rZVN0eWxlID0gXCJyZ2JhKDUwLCAyMDAsIDEwMCwgMC44KVwiO1xuICBjdHguYmVnaW5QYXRoKCk7XG4gIGN0eC5hcmModGhpcy54LCB0aGlzLnksIHRoaXMucmFkaXVzLCAwLCBNYXRoLlBJKjIsdHJ1ZSk7XG4gIGN0eC5maWxsKCk7XG4gIGN0eC5zdHJva2UoKTtcbn1cblxuQmFsbC5wcm90b3R5cGUubW92ZSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnggKz0gdGhpcy5keDtcbiAgdGhpcy55ICs9IHRoaXMuZHk7XG5cbiAgaWYgKCh0aGlzLnggKyB0aGlzLnJhZGl1cykgPiBBcHAuYXZhaWxXKVxuICAgIHRoaXMuZHggPSAtMTtcbiAgZWxzZSBpZiAoKHRoaXMueCAtIHRoaXMucmFkaXVzKSA8IDApIFxuICAgIHRoaXMuZHggPSAxO1xuXG4gIGlmICgodGhpcy55ICsgdGhpcy5yYWRpdXMpID4gQXBwLmF2YWlsSClcbiAgICB0aGlzLmR5ID0gLTE7XG4gIGVsc2UgaWYgKCh0aGlzLnkgLSB0aGlzLnJhZGl1cykgPCAwKSBcbiAgICB0aGlzLmR5ID0gMTtcblxufVxuXG5cbnZhciBBcHAgPSB7XG4gIGJhbGxzOiBbXSxcbiAgYmFsbF9yYWRpdXM6IDM1LFxuICBuX29mX2JhbGxzOiA3LFxuICBrZXlwcmVzc2VkIDogW10sXG4gIGtleUxpc3RlbmVycyA6IFtdLCAvLyBmdW5jdGlvbnMgdG8gbGlzdGVuIGZvciBrZXlzIHByZXNzZWRcbiAgYXZhaWxXOiAwLFxuICBhdmFpbEg6IDAsXG4gIFBFUklPRDogMTAwMC8zMCwgLy8gbWlsbGlzZW5jb25kc1xuICBib3JkZXJMaW1pdDogIDAuMjUgLy8gZm9yIG5ldyBiYWxsc1xufVxuXG5cbmZ1bmN0aW9uIEhlcm8oKSB7XG59XG5cbkhlcm8ucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5wb2ludHMgPSAwO1xuICB0aGlzLnggPSBBcHAuYXZhaWxXLzI7XG4gIHRoaXMueSA9IEFwcC5hdmFpbEgvMjtcbiAgdGhpcy5yYWRpdXMgPSA0MDtcbiAgaWYgKHRoaXMua2V5RXZlbnQpXG4gICAgZGVsZXRlKEFwcC5rZXlMaXN0ZW5lcnNbdGhpcy5rZXlFdmVudC0xXSk7XG4gIHRoaXMua2V5RXZlbnQgPSBBcHAua2V5TGlzdGVuZXJzLnB1c2godGhpcy5jaGVja01vdmVtZW50KCkpO1xufVxuXG5IZXJvLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24oKSB7XG4gIGxldCBjdHggPSBBcHAuY3R4O1xuICBjdHguZmlsbFN0eWxlID0gXCJyZ2JhKDI1NSwgMTAwLCAxMDAsIDAuNSlcIjtcbiAgY3R4LmZpbGxSZWN0KCh0aGlzLngpIC0gMjAsICh0aGlzLnkpIC0gMjAsIDQwLDQwKTtcbiAgY3R4LnN0cm9rZVN0eWxlID0gXCJyZ2JhKDE1NSwgNTAsIDUwLCAwLjgpXCI7XG4gIGN0eC5zdHJva2VSZWN0KCh0aGlzLngpIC0gMjAsICh0aGlzLnkpIC0gMjAsIDQwLDQwKTtcblxuICBjdHguZmlsbFN0eWxlID0gXCJyZ2JhKDI1NSwgMjU1LCAxMDAsIDAuNSlcIjtcbiAgY3R4LmJlZ2luUGF0aCgpO1xuICBjdHguYXJjKHRoaXMueCx0aGlzLnksMTIsMCxNYXRoLlBJLGZhbHNlKTsgICAvLyBNb3V0aCAoY2xvY2t3aXNlKVxuICBjdHgubW92ZVRvKHRoaXMueC0xMCx0aGlzLnktMTApO1xuICBjdHguYXJjKHRoaXMueC0xMCx0aGlzLnktMTAsNSwwLE1hdGguUEkqMix0cnVlKTsgIC8vIExlZnQgZXllXG4gIGN0eC5tb3ZlVG8odGhpcy54KzEwLHRoaXMueS0xMCk7XG4gIGN0eC5hcmModGhpcy54KzEwLHRoaXMueS0xMCw1LDAsTWF0aC5QSSoyLHRydWUpOyAgLy8gUmlnaHQgZXllXG4gIGN0eC5zdHJva2UoKTtcbn1cblxuSGVyby5wcm90b3R5cGUuY2hlY2tNb3ZlbWVudCA9IGZ1bmN0aW9uKCkge1xuICBsZXQgdGhhdCA9IHRoaXM7XG5cbiAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuXG4gICAgaWYgKEFwcC5rZXlwcmVzc2VkWzM3XSkge1xuICAgICAgdGhhdC54LS07IFxuICAgICAgdGhhdC5wb2ludHMrKztcbiAgICB9XG4gICAgaWYgKEFwcC5rZXlwcmVzc2VkWzM5XSkge1xuICAgICAgdGhhdC54Kys7IFxuICAgICAgdGhhdC5wb2ludHMrKztcbiAgICB9XG4gICAgaWYgKEFwcC5rZXlwcmVzc2VkWzM4XSkge1xuICAgICAgdGhhdC55LS07IFxuICAgICAgdGhhdC5wb2ludHMrKztcbiAgICB9XG4gICAgaWYgKEFwcC5rZXlwcmVzc2VkWzQwXSkge1xuICAgICAgdGhhdC55Kys7IFxuICAgICAgdGhhdC5wb2ludHMrKztcbiAgICB9XG4gIH1cbn1cblxudmFyIGhlcm8gPSBuZXcgSGVybygpO1xuXG5cbmZ1bmN0aW9uIGRvTW92ZW1lbnRzKCkge1xuICBmb3IodmFyIGs9MDsgayA8IEFwcC5rZXlMaXN0ZW5lcnMubGVuZ3RoOyBrKyspIHtcbiAgICBpZiAodHlwZW9mKEFwcC5rZXlMaXN0ZW5lcnNba10pID09IFwiZnVuY3Rpb25cIilcbiAgICAgIEFwcC5rZXlMaXN0ZW5lcnNba10oKTtcbiAgfVxufVxuXG5cbmZ1bmN0aW9uIGRyYXcoKSB7XG4gICAgbGV0IGN0eCA9IEFwcC5jdHg7XG4gICAgbGV0IGJhbGxzID0gQXBwLmJhbGxzO1xuXG4gICAgY3R4LmNsZWFyUmVjdCgwLDAsQXBwLmF2YWlsVyxBcHAuYXZhaWxIKTsgLy8gY2xlYXIgY2FudmFzXG4gICAgY3R4LnNhdmUoKTtcblxuICAgIGhlcm8uZHJhdygpO1xuXG4gICAgZm9yICh2YXIgayA9IDA7IGs8YmFsbHMubGVuZ3RoOyBrKyspIHtcbiAgICAgIGxldCBiID0gYmFsbHNba107XG4gICAgICBiLm1vdmUoKTtcbiAgICAgIGIuZHJhdygpO1xuICAgIH1cblxuICAgIGN0eC5maWxsU3R5bGUgPSBcInJnYmEoMTAwLCAxMDAsIDI1NSwgMC44KVwiO1xuICAgIGN0eC5maWxsVGV4dCh6ZXJvcGFkKGhlcm8ucG9pbnRzLDgpLCBBcHAuYXZhaWxXICogKDIvMyksIDQwKTtcbiAgICBjdHguZmlsbFN0eWxlID0gXCJyZ2JhKDEwMCwgMTAwLCAyNTUsIDAuNilcIjtcbiAgICBjdHguZmlsbFRleHQoXCJVc2UgdGhlIEFycm93IEtleXMgdG8gU1VSVklWRSFcIixcbiAgICAgICAgQXBwLmF2YWlsVyAqICgzLzcpLFxuICAgICAgICBBcHAuYXZhaWxIICogKDIvMykpO1xuXG4gICAgY3R4LnJlc3RvcmUoKTtcblxuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhdyk7XG59XG5cbmZ1bmN0aW9uIGNoZWNrUG9zaXRpb25zKGVsMSwgZWwyKSB7XG4gIHZhciBkeCA9IGVsMS54IC0gZWwyLng7XG4gIHZhciBkeSA9IGVsMS55IC0gZWwyLnk7XG4gIFxuICB2YXIgZCA9IE1hdGguc3FydCgoZHgqZHgpICsgKGR5KmR5KSk7XG4gIHZhciByID0gZWwxLnJhZGl1cyArIGVsMi5yYWRpdXM7XG5cbiAgaWYgKHIgPiBkKSBcbiAgICByZXR1cm4gdHJ1ZTtcbiAgZWxzZVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gY2hlY2tNb3ZlbWVudHMoKSB7XG4gIGxldCBiYWxscyA9IEFwcC5iYWxscztcblxuICBmb3IobGV0IGs9MDsgazxiYWxscy5sZW5ndGg7IGsrKykge1xuICAgIGlmIChjaGVja1Bvc2l0aW9ucyhoZXJvLCBiYWxsc1trXSkpIHtcbiAgICAgIGhlcm8uaW5pdCgpO1xuICAgIH1cbiAgICBpZiAoY2hlY2tQb3NpdGlvbnMoYmFsbHNba10sIGJhbGxzWyhrKzEpJWJhbGxzLmxlbmd0aF0pKSB7XG4gICAgICBiYWxsc1trXS5keCAqPSAtMTtcbiAgICAgIGJhbGxzW2tdLmR5ICo9IC0xO1xuICAgICAgYmFsbHNba10ueCArPSBiYWxsc1trXS5keCozO1xuICAgICAgYmFsbHNba10ueSArPSBiYWxsc1trXS5keSozO1xuICAgICAgbGV0IGIgPSBiYWxsc1soaysxKSViYWxscy5sZW5ndGhdO1xuICAgICAgYi5keCAqPSAtMTtcbiAgICAgIGIuZHkgKj0gLTE7XG4gICAgICBiLnggKz0gYi5keCoyO1xuICAgICAgYi55ICs9IGIuZHkqMjtcbiAgICB9XG4gIH1cbn1cblxuXG5mdW5jdGlvbiBpbml0KCkge1xuICBsZXQgd2luVywgd2luSDtcblxuICBpZiAoZG9jdW1lbnQuYm9keSAmJiBkb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoKSB7XG4gICB3aW5XID0gZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aDtcbiAgIHdpbkggPSBkb2N1bWVudC5ib2R5Lm9mZnNldEhlaWdodDtcbiAgfVxuICBpZiAoZG9jdW1lbnQuY29tcGF0TW9kZT09J0NTUzFDb21wYXQnICYmXG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmXG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoICkge1xuICAgIHdpblcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgd2luSCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gIH1cbiAgaWYgKHdpbmRvdy5pbm5lcldpZHRoICYmIHdpbmRvdy5pbm5lckhlaWdodCkge1xuICAgIHdpblcgPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICB3aW5IID0gd2luZG93LmlubmVySGVpZ2h0O1xuICB9XG5cbiAgbGV0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzY3JlZW5GcmFtZVwiKTtcbiAgZWwuc3R5bGVbXCJiYWNrZ3JvdW5kLWNvbG9yXCJdID0gXCJ0cmFuc3BhcmVudFwiO1xuICBlbC5zdHlsZVtcImNvbG9yXCJdID0gXCJyZWRcIjtcbiAgZWwuc3R5bGUubGVmdCA9IFwiMHB4XCI7XG4gIGVsLnN0eWxlLnRvcCA9IFwiMHB4XCI7XG4gIGVsLnN0eWxlLndpZHRoID0gd2luVytcInB4XCI7XG4gIGVsLnN0eWxlLmhlaWdodCA9IHdpbkgrXCJweFwiO1xuICBlbC5zdHlsZS5kaXNwbGF5PVwiYmxvY2tcIjtcblxuICBsZXQgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImZyYW1lXCIpO1xuICBmcmFtZS53aWR0aCA9IHdpblc7XG4gIGZyYW1lLmhlaWdodD0gd2luSDtcblxuICBBcHAuYXZhaWxXID0gd2luVztcbiAgQXBwLmF2YWlsSCA9IHdpbkg7XG4gIEFwcC5mcmFtZSA9IGZyYW1lO1xuXG5cbiAgaWYgKGZyYW1lLmdldENvbnRleHQpIHtcbiAgICBBcHAuY3R4ID0gZnJhbWUuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIEFwcC5jdHguZm9udCA9IFwiMjBwdCBBcmlhbFwiO1xuXG4gICAgbGV0IGkgPSAwO1xuICAgIHdoaWxlKGkgPCBBcHAubl9vZl9iYWxscykge1xuICAgICAgbGV0IGIgPSBuZXcgQmFsbChBcHAuY3R4KTtcbiAgICAgIGIuaW5pdCgpO1xuXG4gICAgICBsZXQgY29sbGlzaW9ucyA9IEFwcC5iYWxscy5maWx0ZXIoKGJhbGwpID0+IGNoZWNrUG9zaXRpb25zKGIsIGJhbGwpKVxuICAgICAgaWYgKGNvbGxpc2lvbnMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG5cbiAgICAgIEFwcC5iYWxscy5wdXNoKGIpO1xuICAgICAgaSsrXG4gICAgfVxuXG4gICAgaGVyby5pbml0KCk7XG5cbiAgICB3aW5kb3cub25rZXlkb3duID0gZnVuY3Rpb24oZSkge1xuICAgICAgQXBwLmtleXByZXNzZWRbZS53aGljaF0gPSB0cnVlO1xuICAgIH1cbiAgICB3aW5kb3cub25rZXl1cD0gZnVuY3Rpb24oZSkge1xuICAgICAgQXBwLmtleXByZXNzZWRbZS53aGljaF0gPSBmYWxzZTtcbiAgICB9XG5cbiAgICBBcHAuZnJhbWUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgaGFuZGxlVG91Y2hTdGFydCwgZmFsc2UpXG4gICAgQXBwLmZyYW1lLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBoYW5kbGVUb3VjaEVuZCwgZmFsc2UpXG5cbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGRyYXcpO1xuICAgIHNldEludGVydmFsKGNoZWNrTW92ZW1lbnRzLDEwMDAvMzApO1xuICAgIHNldEludGVydmFsKGRvTW92ZW1lbnRzLDEwMDAvMzApO1xuICB9IFxuXG4gIGZ1bmN0aW9uIGhhbmRsZVRvdWNoU3RhcnQoZXZ0KSB7XG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc29sZS5sb2coXCJ0b3VjaHN0YXJ0LlwiKTtcbiAgICB2YXIgdG91Y2hlcyA9IGV2dC5jaGFuZ2VkVG91Y2hlcztcbiAgICAgICAgICBcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvdWNoZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnNvbGUubG9nKFwidG91Y2hzdGFydDpcIiArIGkgKyBcIi4uLlwiICsgdG91Y2hlc1tpXSk7XG4gICAgICBjb25zb2xlLmxvZyhcInRvdWNoc3RhcnQ6XCIgKyBpICsgXCIuXCIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZVRvdWNoRW5kKGV2dCkge1xuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHZhciB0b3VjaGVzID0gZXZ0LmNoYW5nZWRUb3VjaGVzO1xuICBcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvdWNoZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnNvbGUubG9nKHRvdWNoZXNbaV0pXG4gICAgfVxuICB9XG5cbn1cblxuIiwiLy8gaW5pdCBcbnJlYWR5KGZ1bmN0aW9uKCkge1xuICBleHBhbmRfanNvbigpO1xuXG4gIGluaXQoKTtcbn0pO1xuXG5mdW5jdGlvbiBpbnRpdGxlKHN0cikge1xuXHRyZXR1cm4gXCI8aDM+XCIgKyAoc3RyLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3RyLnNsaWNlKDEpKS5yZXBsYWNlKFwiX1wiLCBcIiBcIikgKyBcIjwvaDM+XCI7XG59XG5cbmZ1bmN0aW9uIGV4cGFuZF9qc29uKCkge1xuXHRmb3IgKGxldCBrZXkgaW4gRGF0YSkge1xuXHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGtleSkuaW5uZXJIVE1MID0gaW50aXRsZShrZXkpICsgRGF0YVtrZXldO1xuXHR9XG59XG5cblxuZnVuY3Rpb24gcmVhZHkoZm4pIHtcbiAgaWYgKGRvY3VtZW50LmF0dGFjaEV2ZW50ID8gZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gXCJjb21wbGV0ZVwiIDogZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gXCJsb2FkaW5nXCIpe1xuICAgIGZuKCk7XG4gIH0gZWxzZSB7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZuKTtcbiAgfVxufVxuXG5cbmZ1bmN0aW9uIHRvZ2dsZUNsYXNzKGVsLCBjbGFzc05hbWUpIHtcbiAgICBpZiAoZWwuY2xhc3NMaXN0KSB7XG4gICAgICBlbC5jbGFzc0xpc3QudG9nZ2xlKGNsYXNzTmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBjbGFzc2VzID0gZWwuY2xhc3NOYW1lLnNwbGl0KCcgJyk7XG4gICAgICB2YXIgZXhpc3RpbmdJbmRleCA9IGNsYXNzZXMuaW5kZXhPZihjbGFzc05hbWUpO1xuXG4gICAgICBpZiAoZXhpc3RpbmdJbmRleCA+PSAwKVxuICAgICAgICBjbGFzc2VzLnNwbGljZShleGlzdGluZ0luZGV4LCAxKTtcbiAgICAgIGVsc2VcbiAgICAgICAgY2xhc3Nlcy5wdXNoKGNsYXNzTmFtZSk7XG5cbiAgICAgIGVsLmNsYXNzTmFtZSA9IGNsYXNzZXMuam9pbignICcpO1xuICAgIH1cbn1cblxuIl19